<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Task 3</title>
    <link rel = "stylesheet" type = "text/css" href = "style.css" />
</head>
<body>
<header>
    <h1>Calendar of Music events in Minsk</h1>
</header>

<section id="main">

</section>

<script>
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/task-3/sw.js', { scope: '/task-3/' }).then(function(reg) {

            if(reg.installing) {
                console.log('Service worker installing');
            } else if(reg.waiting) {
                console.log('Service worker installed');
            } else if(reg.active) {
                console.log('Service worker active');
            }
        })
            .catch(function(error) {
                // registration failed
                console.log('Registration failed with ' + error);
            });
    }



    function notify(data) {
        const today = new Date();

        const dateArray = data.map(item => {
            return new Date(item.start.date.replace( /-/g, `/`));
        });

        dateArray.forEach(item => {
            const timeDiff = Math.abs(item.getTime() - today);
            const diffDays = Math.ceil(timeDiff / (1000 * 3600 * 24));
            if(diffDays <= 50) {
                if (!("Notification" in window)) {
                    alert("This browser does not support desktop notification");
                }

                else if (Notification.permission === "granted") {
                    let notification = new Notification('Notification title', {
                        icon: './images/music.png',
                        body: "Hey there! You've been notified!",
                    });

                    notification.onclick = function () {
                        window.open("http://stackoverflow.com/a/13328397/1269037");
                    };
                }
                else if (Notification.permission !== 'denied') {
                    Notification.requestPermission(function (permission) {
                        if (permission === "granted") {
                            let notification = new Notification('Notification title', {
                                icon: './images/music.png',
                                body: "Hey there! You've been notified!",
                            });

                            notification.onclick = function () {
                                window.open("http://stackoverflow.com/a/13328397/1269037");
                            };
                        }
                    });
                }
            }
        });
    }
</script>
<script src="app.js"></script>
</body>
</html>